{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="section-content padding-y bg">
  <div class="container">

    <!-- PRODUCT MAIN CARD -->
    <div class="card p-4 mb-4">
      <div class="row">

        <!-- LEFT: IMAGE -->
        <div class="col-md-5">
          <div class="product-image-box">
            <img 
              id="mainProductImage"
              src="{{ single_product.images.url }}"
              class="img-fluid rounded"
            >
          </div>

          {% if product_gallery %}
          <div class="d-flex mt-3">

            <!-- MAIN IMAGE THUMB -->
            <img 
              src="{{ single_product.images.url }}"
              class="img-thumbnail mr-2 thumb-image active-thumb"
              onclick="changeImage(this)"
            >

            {% for i in product_gallery %}
            <img 
              src="{{ i.image.url }}"
              class="img-thumbnail mr-2 thumb-image"
              onclick="changeImage(this)"
            >
            {% endfor %}

          </div>
          {% endif %}
        </div>

        <!-- RIGHT: PRODUCT INFO -->
        <div class="col-md-7">

          <h2 class="mb-2">{{ single_product.product_name }}</h2>

          <div class="rating-star mb-2">
            <span>
              <i class="fa fa-star{% if single_product.averageReview < 0.5 %}-o{% endif %}"></i>
              <i class="fa fa-star{% if single_product.averageReview < 1.5 %}-o{% endif %}"></i>
              <i class="fa fa-star{% if single_product.averageReview < 2.5 %}-o{% endif %}"></i>
              <i class="fa fa-star{% if single_product.averageReview < 3.5 %}-o{% endif %}"></i>
              <i class="fa fa-star{% if single_product.averageReview < 4.5 %}-o{% endif %}"></i>
              <small class="text-muted ml-2">
                ({{ single_product.countReview }} reviews)
              </small>
            </span>
          </div>

          <h3 class="price mb-3">$ {{ single_product.price }}</h3>

          <p class="text-muted" style="line-height:1.7">
            {{ single_product.description }}
          </p>

          <form action="{% url 'add_cart' single_product.id %}" method="POST">
            {% csrf_token %}

            <div class="form-group">
              <label><b>Choose Color</b></label>
              <select name="color" class="form-control" required>
                <option value="" disabled selected>Select</option>
                {% for i in single_product.variation_set.colors %}
                <option value="{{ i.variation_value|lower }}">
                  {{ i.variation_value|capfirst }}
                </option>
                {% endfor %}
              </select>
            </div>

            <div class="form-group">
              <label><b>Select Size</b></label>
              <select name="size" class="form-control">
                <option value="" disabled selected>Select</option>
                {% for i in single_product.variation_set.sizes %}
                <option value="{{ i.variation_value|lower }}">
                  {{ i.variation_value|capfirst }}
                </option>
                {% endfor %}
              </select>
            </div>

            <div class="d-flex align-items-center mt-4">
              {% if single_product.stock > 0 %}
              <button type="submit" class="btn btn-primary mr-3">
                <i class="fa fa-shopping-cart"></i> Add to Cart
              </button>
              {% else %}
              <span class="text-danger font-weight-bold">Out of Stock</span>
              {% endif %}

              {% if user.is_authenticated %}
                {% if is_in_wishlist %}
                  <button class="btn btn-danger" disabled>
                    <i class="fa fa-heart"></i> Wishlisted
                  </button>
                {% else %}
                  <a href="{% url 'add_to_wishlist' single_product.id %}" class="btn btn-outline-danger">
                    <i class="far fa-heart"></i> Add to Wishlist
                  </a>
                {% endif %}
              {% endif %}
            </div>

          </form>

        </div>
      </div>
    </div>

    <!-- REVIEWS -->
    <div class="card p-4">
      <h4 class="mb-4">Customer Reviews</h4>

{% for review in reviews %}
  <div class="border-bottom pb-3 mb-3">
    <b>{{ review.user.full_name }}</b>
    <p>{{ review.review }}</p>
  </div>
{% empty %}
  <p class="text-muted">No reviews yet.</p>
{% endfor %}

<hr>

<h5>Write a Review</h5>

{% if user.is_authenticated %}
    {% if orderproduct %}
        <form action="{% url 'submit_review' single_product.id %}" method="POST">
            {% csrf_token %}
            <input type="text" name="subject" class="form-control mb-2" placeholder="Review title">
            <textarea name="review" class="form-control mb-2" rows="3" placeholder="Your review"></textarea>
            <select name="rating" class="form-control mb-2">
                <option value="">Rating</option>
                <option value="1">1 ⭐</option>
                <option value="2">2 ⭐⭐</option>
                <option value="3">3 ⭐⭐⭐</option>
                <option value="4">4 ⭐⭐⭐⭐</option>
                <option value="5">5 ⭐⭐⭐⭐⭐</option>
            </select>
            <button class="btn btn-primary">Submit Review</button>
        </form>
    {% else %}
        <p class="text-muted">You must purchase this product to review.</p>
    {% endif %}
{% else %}
    <p><a href="{% url 'login' %}">Login</a> to write a review.</p>
{% endif %}

    </div>

  </div>
</section>

{% endblock %}
