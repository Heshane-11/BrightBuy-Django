<h2>Track Order #{{ order.order_number }}</h2>

<p>
  Status:
  <span id="order-status" class="badge badge-warning">
    {{ order.status }}
  </span>
</p>

<script>
const orderId = "{{ order.id }}";
const protocol = window.location.protocol === "https:" ? "wss" : "ws";

const socket = new WebSocket(
  protocol + "://" + window.location.host + "/ws/order/" + orderId + "/"
);

socket.onopen = () => {
  console.log("✅ WebSocket connected");
};

socket.onmessage = (e) => {
  const data = JSON.parse(e.data);
  const badge = document.getElementById("order-status");

  if (data.status === "Pending") {
    badge.innerText = "Pending";
    badge.className = "badge badge-warning";
  }
  if (data.status === "Shipped") {
    badge.innerText = "Shipped";
    badge.className = "badge badge-success";
  }
  if (data.status === "Delivered") {
    badge.innerText = "Delivered";
    badge.className = "badge badge-primary";
  }
};

socket.onclose = () => {
  console.log("⚠️ WebSocket closed");
};
</script>
